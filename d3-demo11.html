<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="Creating a Pie and Donut chart in D3" content="In this demo it was demonstarted how to use the arc path generator in to genearte a  pie/donut chart in d3">
    <title>D3 Demo 11</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
  </head>
  <body>
    <script>

    //To create a donut chart we have to first create elements to bind our data to the arcs.
    //  var arcs = group.selectAll(".arc")
                // .data(pie(data))
                // .enter()
                //   .append("g")
                //   .attr("class", "arc");
    //here we create a group element to represent a data point which will is converted to an object for segments/arcs using d3.pie()
    //d3.pie() converts a data point of many data points into objects of
    // {"data":  1, "value":  1, "index": 6, "startAngle": 6.050474740247008, "endAngle": 6.166830023713296, "padAngle": 0},
    //which d3.arc (.attr("d", arc)) will use to create the relevant arcs for each data point
    //Note we must create the arcs with the "arc" class (or any other name) to grab that item specifically
    //We must then add different colors to our segments to make them distinguishable
    //  var color = d3.scaleOrdinal()
                    // .range(["red", "blue", "orange"])
    //If no domain is specifed the first d is assiged the first color
    //We can use the index to instead of the value to set the color incase of repeat values

    //to add text to each segment we use  arc.centroid(d)  which computes the midpoint [x, y] of the center line of the arc that would be generated by the given arguments

    //.attr("text-anchor","middle") centers the text more

    //Note to create a pie chart just set the inner radius to zero


      var data = [10, 50, 60, 50, 40]
      var r = 100;

      var color = d3.scaleOrdinal()
                    .range(["red", "blue", "orange","purple","grey"])

      var canvas = d3.select("body").append("svg")
                    .attr("width",500)
                    .attr("height",500)

      var group = canvas.append("g")
            .attr("transform", "translate(200,200)")

      var arc = d3.arc()
              .innerRadius(200)
              .outerRadius(r)

      var pie = d3.pie()
                .value((d)=>(d));

      var arcs = group.selectAll(".arc")
                .data(pie(data))
                .enter()
                  .append("g")
                  .attr("class", "arc")

      //NOTE WE MUST DO THIS IN A SEPARATE STATMENT
      //can append path unless the group is actually created
      arcs.append("path")
          .attr("d", arc)
          .attr("fill", (d,i)=>(color(i)))

      arcs.append("text")
          .attr("transform", (d) => (
            "translate(" + arc.centroid(d) + ")"
          ))
          .text((d)=>(d.data))
          .attr("text-anchor","middle")
          .attr("font-size","1.5em")
          .attr("fill","white")

      val = 0
      setInterval(()=>{
        val += 10
        arcs.transition()
        .duration(100)
        .attr("transform",`rotate(${val})`)
      }, 60)

    </script>
  </body>
</html>
